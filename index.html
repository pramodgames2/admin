<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Store Admin - Login</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: #111; padding: 40px; border-radius: 10px; border: 1px solid #333; text-align: center; width: 300px; }
        h2 { letter-spacing: 2px; margin-bottom: 30px; }
        button { background: #fff; color: #000; border: none; padding: 12px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; width: 100%; }
        button:hover { background: #ccc; }
        #adminPanel { display: none; width: 90%; max-width: 500px; background: #111; padding: 20px; border-radius: 10px; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; box-sizing: border-box; }
        .upload-btn { background: #28a745; color: white; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="loginSection" class="login-card">
        <h2>BLACK STORE</h2>
        <p>Secure Admin Login</p>
        <button id="loginBtn">Login with Google</button>
    </div>

    <div id="adminPanel">
        <h2>Admin Panel</h2>
        <p id="userEmail"></p>
        <input type="text" id="gameTitle" placeholder="Game Title">
        <input type="text" id="imageURL" placeholder="Image URL (Link)">
        <input type="text" id="downloadURL" placeholder="Download URL (Link)">
        <button class="upload-btn" id="uploadBtn">UPLOAD GAME</button>
        <button onclick="location.reload()" style="background:#555; margin-top:10px;">Logout</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0ZqCnq28-bauG3YBb7WrVVNdQgYOGmqg",
            authDomain: "black-store-login.firebaseapp.com",
            databaseURL: "https://black-store-login-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "black-store-login",
            storageBucket: "black-store-login.firebasestorage.app",
            messagingSenderId: "980593701862",
            appId: "1:980593701862:web:eabd842d94a728c2c9c27"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        const allowedEmail = "Shiyamal5005@gmail.com"; // මෙන්න ඔයාගේ ඊමේල් එක

        // Login Function
        document.getElementById('loginBtn').onclick = () => {
            signInWithPopup(auth, provider).catch(err => alert("Error: " + err.message));
        };

        // Check Auth State
        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.email === allowedEmail) {
                    document.getElementById('loginSection').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    document.getElementById('userEmail').innerText = "Logged in as: " + user.email;
                } else {
                    alert("Unauthorized! Only Shiyamal can access this.");
                    auth.signOut();
                }
            }
        });

        // Upload Function
        document.getElementById('uploadBtn').onclick = () => {
            const title = document.getElementById('gameTitle').value;
            const img = document.getElementById('imageURL').value;
            const link = document.getElementById('downloadURL').value;

            if(title && img && link) {
                push(ref(db, 'games'), {
                    title: title,
                    imageURL: img,
                    downloadURL: link
                }).then(() => {
                    alert("Game Uploaded Successfully!");
                    document.getElementById('gameTitle').value = "";
                    document.getElementById('imageURL').value = "";
                    document.getElementById('downloadURL').value = "";
                });
            } else {
                alert("Please fill all fields!");
            }
        };
    </script>
</body>
</html>
